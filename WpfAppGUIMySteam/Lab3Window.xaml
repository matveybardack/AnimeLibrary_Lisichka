<Window x:Class="WpfAppGUIMySteam.Lab3Window"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="ЛР-3: Циклы под микроскопом"
        WindowState="Maximized"
        WindowStartupLocation="CenterScreen"
        Background="#0f3460">

    <Window.Resources>
        <!-- Стили в японском стиле -->
        <Style x:Key="AnimeCard" TargetType="Border">
            <Setter Property="Background" Value="#1a1a2e"/>
            <Setter Property="BorderBrush" Value="#e94560"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Margin" Value="10"/>
            <Setter Property="Padding" Value="15"/>
        </Style>

        <Style x:Key="AnimeButton" TargetType="Button">
            <Setter Property="Background" Value="#e94560"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

        <Style x:Key="DataGridStyle" TargetType="DataGrid">
            <Setter Property="Background" Value="#16213e"/>
            <Setter Property="Foreground" Value="#16213e"/>
            <Setter Property="BorderBrush" Value="#e94560"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="RowBackground" Value="#1a1a2e"/>
            <Setter Property="AlternatingRowBackground" Value="#16213e"/>
        </Style>

        <Style x:Key="StatusIndicator" TargetType="Border">
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Width" Value="20"/>
            <Setter Property="Height" Value="20"/>
            <Setter Property="Margin" Value="5"/>
        </Style>
    </Window.Resources>

    <Grid>
        <!-- Фон -->
        <Image Source="/Images/yakuza-0-goro-majima-kiryu-kazuma.jpg" 
               Stretch="UniformToFill" Opacity="0.3"/>

        <DockPanel>
            <!-- Заголовок -->
            <Border DockPanel.Dock="Top" 
                    Background="#1a1a2e" 
                    Padding="15" 
                    BorderThickness="0,0,0,2" 
                    BorderBrush="#e94560">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Button Content="Назад" 
                            Style="{StaticResource AnimeButton}"
                            Command="{Binding BackCommand}"
                            Background="#16213e"
                            Grid.Column="0"/>

                    <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                        <TextBlock Text="ループ解析 - アニメ図書館" 
                                   Foreground="White" 
                                   FontSize="16" 
                                   FontWeight="Bold"
                                   HorizontalAlignment="Center"/>
                        <TextBlock Text="ЛР-3: Циклы под микроскопом - обработка коллекции аниме" 
                                   Foreground="#f8c3af" 
                                   FontSize="12"
                                   HorizontalAlignment="Center"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Основной контент -->
            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Левая колонка - данные и управление -->
                    <StackPanel Grid.Column="0" Margin="0,0,10,0">

                        <!-- Блок выбора режима -->
                        <Border Style="{StaticResource AnimeCard}" Margin="0,0,0,15">
                            <StackPanel>
                                <TextBlock Text="🎯 Режимы обработки коллекции аниме" 
                                           Foreground="#e94560" 
                                           FontWeight="Bold" 
                                           FontSize="14"
                                           Margin="0,0,0,10"/>

                                <ComboBox ItemsSource="{Binding Modes}"
                                          SelectedItem="{Binding SelectedMode}"
                                          DisplayMemberPath="Name"
                                          Background="#16213e" 
                                          Foreground="White" 
                                          BorderBrush="#e94560"
                                          Height="25"/>

                                <TextBlock Text="{Binding SelectedMode.Description}" 
                                           Foreground="#cccccc" 
                                           FontSize="12"
                                           TextWrapping="Wrap"
                                           Margin="0,5,0,0"/>
                            </StackPanel>
                        </Border>

                        <!-- Блок составления условий фильтра -->
                        <Border Style="{StaticResource AnimeCard}" Margin="0,0,0,15">
                            <StackPanel>
                                <TextBlock Text="🔍 Составление условий фильтра" 
                                           Foreground="#e94560" 
                                           FontWeight="Bold" 
                                           FontSize="14"
                                           Margin="0,0,0,10"/>

                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Text="Тип:" 
                                               Foreground="#cccccc" 
                                               FontSize="12"
                                               Grid.Row="0" Grid.Column="0"
                                               VerticalAlignment="Center"
                                               Margin="0,0,5,0"/>
                                    <TextBox Text="{Binding FilterType}"
                                             Background="#16213e" 
                                             Foreground="White" 
                                             BorderBrush="#e94560"
                                             Height="25"
                                             Grid.Row="0" Grid.Column="1"
                                             Margin="0,0,10,5"/>

                                    <TextBlock Text="Рейтинг:" 
                                               Foreground="#cccccc" 
                                               FontSize="12"
                                               Grid.Row="0" Grid.Column="2"
                                               VerticalAlignment="Center"
                                               Margin="0,0,5,0"/>
                                    <TextBox Text="{Binding FilterRating}"
                                             Background="#16213e" 
                                             Foreground="White" 
                                             BorderBrush="#e94560"
                                             Height="25"
                                             Grid.Row="0" Grid.Column="3"
                                             Margin="0,0,0,5"/>

                                    <TextBlock Text="Оператор:" 
                                               Foreground="#cccccc" 
                                               FontSize="12"
                                               Grid.Row="1" Grid.Column="0"
                                               VerticalAlignment="Center"
                                               Margin="0,0,5,0"/>
                                    <ComboBox ItemsSource="{Binding FilterOperators}"
                                              SelectedItem="{Binding SelectedFilterOperator}"
                                              Background="#16213e" 
                                              Foreground="White" 
                                              BorderBrush="#e94560"
                                              Height="25"
                                              Grid.Row="1" Grid.Column="1"
                                              Margin="0,0,10,5"/>

                                    <Button Content="Применить фильтр" 
                                            Style="{StaticResource AnimeButton}"
                                            Command="{Binding ApplyFilterCommand}"
                                            Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="4"
                                            Margin="0,10,0,0"/>
                                </Grid>

                                <TextBlock Text="Текущее условие:" 
                                           Foreground="#cccccc" 
                                           FontSize="12"
                                           Margin="0,10,0,5"/>
                                <TextBox Text="{Binding CurrentFilterCondition}"
                                         Background="#16213e" 
                                         Foreground="White" 
                                         BorderBrush="#e94560"
                                         Height="30"
                                         IsReadOnly="True"
                                         FontWeight="Bold"/>
                            </StackPanel>
                        </Border>

                        <!-- Блок генерации данных -->
                        <Border Style="{StaticResource AnimeCard}" Margin="0,0,0,15">
                            <StackPanel>
                                <TextBlock Text="📊 Генератор данных аниме" 
                                           Foreground="#e94560" 
                                           FontWeight="Bold" 
                                           FontSize="14"
                                           Margin="0,0,0,10"/>

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <StackPanel Grid.Column="0" Grid.Row="0" Margin="0,0,5,0">
                                        <TextBlock Text="Количество аниме" Foreground="#cccccc" FontSize="12"/>
                                        <TextBox Text="{Binding AnimeCount}"
                                                 Background="#16213e" 
                                                 Foreground="White" 
                                                 BorderBrush="#e94560"
                                                 Height="25"/>
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" Grid.Row="0" Margin="5,0,0,0">
                                        <TextBlock Text="Порог рейтинга" Foreground="#cccccc" FontSize="12"/>
                                        <TextBox Text="{Binding RatingThreshold}"
                                                 Background="#16213e" 
                                                 Foreground="White" 
                                                 BorderBrush="#e94560"
                                                 Height="25"/>
                                    </StackPanel>

                                    <Button Content="Сгенерировать данные" 
                                            Style="{StaticResource AnimeButton}"
                                            Command="{Binding GenerateDataCommand}"
                                            Grid.Column="0" Grid.Row="1" Grid.ColumnSpan="2"
                                            Margin="0,10,0,0"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Блок управления выполнением -->
                        <Border Style="{StaticResource AnimeCard}" Margin="0,0,0,15">
                            <StackPanel>
                                <TextBlock Text="⚡ Управление выполнением" 
                                           Foreground="#e94560" 
                                           FontWeight="Bold" 
                                           FontSize="14"
                                           Margin="0,0,0,10"/>

                                <StackPanel Orientation="Horizontal">
                                    <Button Content="Шаг" 
                                            Style="{StaticResource AnimeButton}"
                                            Command="{Binding StepCommand}"
                                            Margin="0,0,5,0"/>
                                    <Button Content="Пуск" 
                                            Style="{StaticResource AnimeButton}"
                                            Command="{Binding StartCommand}"
                                            Margin="5,0,5,0"/>
                                    <Button Content="Сброс" 
                                            Style="{StaticResource AnimeButton}"
                                            Command="{Binding ResetCommand}"
                                            Background="#16213e"
                                            Margin="5,0,0,0"/>
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                    <TextBlock Text="Текущий индекс: " Foreground="#cccccc" FontSize="12"/>
                                    <TextBlock Text="{Binding CurrentIndex}" 
                                               Foreground="#e94560" 
                                               FontSize="10"
                                               FontWeight="Bold"/>
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                    <TextBlock Text="Результат: " Foreground="#cccccc" FontSize="12"/>
                                    <TextBlock Text="{Binding CurrentResult}" 
                                               Foreground="#e94560" 
                                               FontSize="10"
                                               FontWeight="Bold"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Таблица данных -->
                        <Border Style="{StaticResource AnimeCard}" Margin="0,0,0,15">
                            <StackPanel>
                                <TextBlock Text="📋 Коллекция аниме" 
                                           Foreground="#e94560" 
                                           FontWeight="Bold" 
                                           FontSize="14"
                                           Margin="0,0,0,10"/>

                                <DataGrid ItemsSource="{Binding AnimeCollection}"
                                          Style="{StaticResource DataGridStyle}"
                                          AutoGenerateColumns="False"
                                          Height="200"
                                          IsReadOnly="True">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="50"/>
                                        <DataGridTextColumn Header="Название" Binding="{Binding Title}" Width="150"/>
                                        <DataGridTextColumn Header="Жанр" Binding="{Binding Type}" Width="100"/>
                                        <DataGridTextColumn Header="Год выпуска" Binding="{Binding Year}" Width="80"/>
                                        <DataGridTextColumn Header="Рейтинг" Binding="{Binding Rating}" Width="80"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </StackPanel>
                        </Border>

                    </StackPanel>

                    <!-- Правая колонка - анализ цикла -->
                    <StackPanel Grid.Column="1" Margin="10,0,0,0">

                        <!-- Блок инварианта -->
                        <Border Style="{StaticResource AnimeCard}" Margin="0,0,0,15">
                            <StackPanel>
                                <TextBlock Text="🔄 Инвариант цикла" 
                                           Foreground="#e94560" 
                                           FontWeight="Bold" 
                                           FontSize="14"
                                           Margin="0,0,0,10"/>

                                <TextBlock Text="Формулировка словами:" 
                                           Foreground="#cccccc" 
                                           FontSize="12"/>
                                <TextBox Text="{Binding InvariantDescription}"
                                         Background="#16213e" 
                                         Foreground="White" 
                                         BorderBrush="#e94560"
                                         Height="40"
                                         TextWrapping="Wrap"
                                         IsReadOnly="True"/>

                                <TextBlock Text="Формула:" 
                                           Foreground="#cccccc" 
                                           FontSize="12"
                                           Margin="0,5,0,0"/>
                                <TextBox Text="{Binding InvariantFormula}"
                                         Background="#16213e" 
                                         Foreground="White" 
                                         BorderBrush="#e94560"
                                         Height="30"
                                         IsReadOnly="True"/>

                                <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                    <TextBlock Text="Инвариант до шага:" Foreground="#cccccc" FontSize="12" VerticalAlignment="Center"/>
                                    <Border Style="{StaticResource StatusIndicator}" 
                                            Background="{Binding InvariantBeforeStatus}"/>
                                    <TextBlock Text="Инвариант после шага:" Foreground="#cccccc" FontSize="12" VerticalAlignment="Center" Margin="10,0,0,0"/>
                                    <Border Style="{StaticResource StatusIndicator}" 
                                            Background="{Binding InvariantAfterStatus}"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Блок вариант-функции -->
                        <Border Style="{StaticResource AnimeCard}" Margin="0,0,0,15">
                            <StackPanel>
                                <TextBlock Text="📉 Вариант-функция" 
                                           Foreground="#e94560" 
                                           FontWeight="Bold" 
                                           FontSize="14"
                                           Margin="0,0,0,10"/>

                                <TextBlock Text="Функция:" 
                                           Foreground="#cccccc" 
                                           FontSize="12"/>
                                <TextBox Text="{Binding VariantFunction}"
                                         Background="#16213e" 
                                         Foreground="White" 
                                         BorderBrush="#e94560"
                                         Height="25"
                                         IsReadOnly="True"/>

                                <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                    <TextBlock Text="Текущее значение: " Foreground="#cccccc" FontSize="12"/>
                                    <TextBlock Text="{Binding CurrentVariant}" 
                                               Foreground="#e94560" 
                                               FontSize="12"
                                               FontWeight="Bold"/>
                                </StackPanel>

                                <ProgressBar Value="{Binding VariantProgress}"
                                             Maximum="100"
                                             Height="10"
                                             Margin="0,5,0,0"
                                             Background="#16213e"
                                             Foreground="#e94560"/>

                                <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                    <TextBlock Text="Монотонность: " Foreground="#cccccc" FontSize="12" VerticalAlignment="Center"/>
                                    <Border Style="{StaticResource StatusIndicator}" 
                                            Background="{Binding MonotonicityStatus}"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Блок проверки WP -->
                        <Border Style="{StaticResource AnimeCard}" Margin="0,0,0,15">
                            <StackPanel>
                                <TextBlock Text="🔍 Проверка сохранения инварианта (WP)" 
                                           Foreground="#e94560" 
                                           FontWeight="Bold" 
                                           FontSize="14"
                                           Margin="0,0,0,10"/>

                                <TextBlock Text="Формула: (Inv ∧ B) ⇒ wp(S, Inv)" 
                                           Foreground="#cccccc" 
                                           FontSize="12"/>
                                <TextBox Text="{Binding WpFormula}"
                                         Background="#16213e" 
                                         Foreground="White" 
                                         BorderBrush="#e94560"
                                         Height="40"
                                         TextWrapping="Wrap"
                                         IsReadOnly="True"/>

                                <TextBlock Text="Описание:" 
                                           Foreground="#cccccc" 
                                           FontSize="12"
                                           Margin="0,5,0,0"/>
                                <TextBox Text="{Binding WpDescription}"
                                         Background="#16213e" 
                                         Foreground="White" 
                                         BorderBrush="#e94560"
                                         Height="50"
                                         TextWrapping="Wrap"
                                         IsReadOnly="True"/>
                            </StackPanel>
                        </Border>

                        <!-- Блок постусловия -->
                        <Border Style="{StaticResource AnimeCard}" Margin="0,0,0,15">
                            <StackPanel>
                                <TextBlock Text="✅ Постусловие и верификация" 
                                           Foreground="#e94560" 
                                           FontWeight="Bold" 
                                           FontSize="14"
                                           Margin="0,0,0,10"/>

                                <TextBlock Text="Постусловие:" 
                                           Foreground="#cccccc" 
                                           FontSize="12"/>
                                <TextBox Text="{Binding PostCondition}"
                                         Background="#16213e" 
                                         Foreground="White" 
                                         BorderBrush="#e94560"
                                         Height="30"
                                         IsReadOnly="True"/>

                                <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                    <TextBlock Text="Post-условие выполнено:" Foreground="#cccccc" FontSize="12" VerticalAlignment="Center"/>
                                    <Border Style="{StaticResource StatusIndicator}" 
                                            Background="{Binding PostConditionStatus}"/>
                                </StackPanel>

                                <TextBlock Text="Условия верификации:" 
                                           Foreground="#cccccc" 
                                           FontSize="12"
                                           Margin="0,10,0,5"/>
                                <ItemsControl ItemsSource="{Binding VerificationConditions}"
                                              Background="#16213e"
                                              BorderBrush="#e94560"
                                              BorderThickness="1"
                                              Padding="5"
                                              Height="80"
                                              ScrollViewer.VerticalScrollBarVisibility="Auto">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="#1a1a2e" 
                                                    Margin="1" 
                                                    Padding="5" 
                                                    CornerRadius="3">
                                                <TextBlock Text="{Binding}" 
                                                           Foreground="White" 
                                                           FontSize="12"
                                                           TextWrapping="Wrap"/>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>

                    </StackPanel>
                </Grid>
            </ScrollViewer>
        </DockPanel>
    </Grid>
</Window>